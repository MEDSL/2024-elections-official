# Read data
################################################################################
state_codes <- read.csv(state_code_fname)
progress <- read.csv(file.path(WORK_DIR, "progress.csv"))
state_codes <- merge(state_codes, progress, by = "state")
################################################################################
# Plot progress map
################################################################################
hexmap <- merge(shapes, state_codes, by=c("state_po", "state")) %>%
mutate(status=factor(status, levels = c("done", "qa", "wip", "not done")))
# Using colors from https://github.mit.edu/MEDSL/MEDSL-Wiki/wiki/Branding#colors
(
ggplot(hexmap) +
geom_sf(aes(fill = status)) +
geom_sf_text(aes(label = state_po)) +
scale_fill_manual(
values = c("done" = "#37C256",
"qa" = "#3791FF",
"wip" = "#EBD600",
"not done" = "#EDD0CB"),
labels = c("done" = "Done",
"qa" = "Quality assurance ", # Note extraneous space intentional
"wip" = "In progress",
"not done" = "Not done")
) +
theme_void() +
theme(
legend.position = "right",
legend.text = element_text(size = 8),
text=element_text(family="StyreneB-Regular"),
plot.title = element_text(size = rel(1.25), hjust = .5),
plot.caption = element_text(hjust = 0, size = 8, lineheight = 0.8),
legend.key.size = unit(0.4, "cm")
) +
labs(
title="2024 Precinct Data Progress",
# Extraneous spaces intentional to make pretty
caption = " MIT Election Data + Science Lab\n github.com/MEDSL/2024-elections-official",
fill=NULL
)
) %>%
ggsave(file.path(WORK_DIR, "progress_map.png"),
plot = .,
scale = 0.45,
width = 8, height = 6,
units = c("in"),
dpi = 600, bg="white")
################################################################################
# Plot progress over time
################################################################################
progress <- read.csv(file.path(WORK_DIR, "progress.csv"))
# Sort: states that have 2024 added dates first, NA last
progress <- progress %>%
arrange(is.na(added24), added24, added22)
# Election dates
elec_dates <- c("2020-11-03", "2022-11-08", "2024-11-05") %>% as.Date()
names(elec_dates) <- c("elec20", "elec22", "elec24")
curr_day <- Sys.Date()
curr_diff <- as.integer(round(difftime(curr_day, elec_dates["elec24"])))
progress <- progress %>%
mutate(
diff20 = as.integer(difftime(added20, elec_dates["elec20"])),
diff22 = as.integer(difftime(added22, elec_dates["elec22"])),
diff24 = as.integer(difftime(added24, elec_dates["elec24"]))
)
################################################################################
# Generate a hexmap of the US, with states colored by some binary status and
# a plot of cleaning progress over time
#
# NOTE: this script assumes the branding (https://github.mit.edu/MEDSL/branding)
# and precinct project (https://github.mit.edu/MEDSL/2024-precincts) repos
# live in the same directory (PARENT_DIR) as this repo on your machine
#
# Updated by Zayne in October 2025
# based on the work of mpreece, sbaltz, and curiel
#
# To add in Puerto Rico, check https://vizpainter.com/hex-map-spatial-file/
###############################################################################
library(sf)
library(tidyverse)
library(broom)
library(this.path)
library(lubridate)
################################################################################
# Global variables
################################################################################
PARENT_DIR <- dirname(this.path::here())
WORK_DIR <- this.path::here()
STATE_CODE_PATH <- file.path(PARENT_DIR, "2024-precincts/help-files/")
# Load the MEDSL theme
source(file.path(PARENT_DIR, "branding/theme_ggplot2/medsl_theme.R"))
shapes <- read_sf(file.path(WORK_DIR, "hex_files/hex_states.shp"))
shapes = rename(shapes, state = State, state_po = State_Abbr) # Hate!
state_code_fname <- file.path(STATE_CODE_PATH, "merge_on_statecodes.csv")
################################################################################
# Read data
################################################################################
state_codes <- read.csv(state_code_fname)
progress <- read.csv(file.path(WORK_DIR, "progress.csv"))
state_codes <- merge(state_codes, progress, by = "state")
################################################################################
# Plot progress map
################################################################################
hexmap <- merge(shapes, state_codes, by=c("state_po", "state")) %>%
mutate(status=factor(status, levels = c("done", "qa", "wip", "not done")))
# Using colors from https://github.mit.edu/MEDSL/MEDSL-Wiki/wiki/Branding#colors
(
ggplot(hexmap) +
geom_sf(aes(fill = status)) +
geom_sf_text(aes(label = state_po)) +
scale_fill_manual(
values = c("done" = "#37C256",
"qa" = "#3791FF",
"wip" = "#EBD600",
"not done" = "#EDD0CB"),
labels = c("done" = "Done",
"qa" = "Quality assurance ", # Note extraneous space intentional
"wip" = "In progress",
"not done" = "Not done")
) +
theme_void() +
theme(
legend.position = "right",
legend.text = element_text(size = 8),
text=element_text(family="StyreneB-Regular"),
plot.title = element_text(size = rel(1.25), hjust = .5),
plot.caption = element_text(hjust = 0, size = 8, lineheight = 0.8),
legend.key.size = unit(0.4, "cm")
) +
labs(
title="2024 Precinct Data Progress",
# Extraneous spaces intentional to make pretty
caption = " MIT Election Data + Science Lab\n github.com/MEDSL/2024-elections-official",
fill=NULL
)
) %>%
ggsave(file.path(WORK_DIR, "progress_map.png"),
plot = .,
scale = 0.45,
width = 8, height = 6,
units = c("in"),
dpi = 600, bg="white")
################################################################################
# Plot progress over time
################################################################################
progress <- read.csv(file.path(WORK_DIR, "progress.csv"))
# Sort: states that have 2024 added dates first, NA last
progress <- progress %>%
arrange(is.na(added24), added24, added22)
# Election dates
elec_dates <- c("2020-11-03", "2022-11-08", "2024-11-05") %>% as.Date()
names(elec_dates) <- c("elec20", "elec22", "elec24")
curr_day <- Sys.Date()
curr_diff <- as.integer(round(difftime(curr_day, elec_dates["elec24"])))
progress <- progress %>%
mutate(
diff20 = as.integer(difftime(added20, elec_dates["elec20"])),
diff22 = as.integer(difftime(added22, elec_dates["elec22"])),
diff24 = as.integer(difftime(added24, elec_dates["elec24"]))
)
################################################################################
# Generate a hexmap of the US, with states colored by some binary status and
# a plot of cleaning progress over time
#
# NOTE: this script assumes the branding (https://github.mit.edu/MEDSL/branding)
# and precinct project (https://github.mit.edu/MEDSL/2024-precincts) repos
# live in the same directory (PARENT_DIR) as this repo on your machine
#
# Updated by Zayne in October 2025
# based on the work of mpreece, sbaltz, and curiel
#
# To add in Puerto Rico, check https://vizpainter.com/hex-map-spatial-file/
###############################################################################
library(sf)
library(tidyverse)
library(broom)
library(this.path)
library(lubridate)
################################################################################
# Global variables
################################################################################
PARENT_DIR <- dirname(this.path::here())
WORK_DIR <- this.path::here()
STATE_CODE_PATH <- file.path(PARENT_DIR, "2024-precincts/help-files/")
# Load the MEDSL theme
source(file.path(PARENT_DIR, "branding/theme_ggplot2/medsl_theme.R"))
shapes <- read_sf(file.path(WORK_DIR, "hex_files/hex_states.shp"))
shapes = rename(shapes, state = State, state_po = State_Abbr) # Hate!
state_code_fname <- file.path(STATE_CODE_PATH, "merge_on_statecodes.csv")
################################################################################
# Read data
################################################################################
state_codes <- read.csv(state_code_fname)
progress <- read.csv(file.path(WORK_DIR, "progress.csv"))
state_codes <- merge(state_codes, progress, by = "state")
################################################################################
# Plot progress map
################################################################################
hexmap <- merge(shapes, state_codes, by=c("state_po", "state")) %>%
mutate(status=factor(status, levels = c("done", "qa", "wip", "not done")))
# Using colors from https://github.mit.edu/MEDSL/MEDSL-Wiki/wiki/Branding#colors
(
ggplot(hexmap) +
geom_sf(aes(fill = status)) +
geom_sf_text(aes(label = state_po)) +
scale_fill_manual(
values = c("done" = "#37C256",
"qa" = "#3791FF",
"wip" = "#EBD600",
"not done" = "#EDD0CB"),
labels = c("done" = "Done",
"qa" = "Quality assurance ", # Note extraneous space intentional
"wip" = "In progress",
"not done" = "Not done")
) +
theme_void() +
theme(
legend.position = "right",
legend.text = element_text(size = 8),
text=element_text(family="StyreneB-Regular"),
plot.title = element_text(size = rel(1.25), hjust = .5),
plot.caption = element_text(hjust = 0, size = 8, lineheight = 0.8),
legend.key.size = unit(0.4, "cm")
) +
labs(
title="2024 Precinct Data Progress",
# Extraneous spaces intentional to make pretty
caption = " MIT Election Data + Science Lab\n github.com/MEDSL/2024-elections-official",
fill=NULL
)
) %>%
ggsave(file.path(WORK_DIR, "progress_map.png"),
plot = .,
scale = 0.45,
width = 8, height = 6,
units = c("in"),
dpi = 600, bg="white")
################################################################################
# Plot progress over time
################################################################################
progress <- read.csv(file.path(WORK_DIR, "progress.csv"))
# Sort: states that have 2024 added dates first, NA last
progress <- progress %>%
arrange(is.na(added24), added24, added22)
# Election dates
elec_dates <- c("2020-11-03", "2022-11-08", "2024-11-05") %>% as.Date()
names(elec_dates) <- c("elec20", "elec22", "elec24")
curr_day <- Sys.Date()
curr_diff <- as.integer(round(difftime(curr_day, elec_dates["elec24"])))
progress <- progress %>%
mutate(across(starts_with("added"), lubridate::mdy))
progress <- progress %>%
mutate(
diff20 = as.integer(difftime(added20, elec_dates["elec20"])),
diff22 = as.integer(difftime(added22, elec_dates["elec22"])),
diff24 = as.integer(difftime(added24, elec_dates["elec24"]))
)
# ------------------------------------------------------------------------------
# Build cumulative totals per day
# ------------------------------------------------------------------------------
longest <- max(progress$diff20, progress$diff22, progress$diff24, na.rm = TRUE)
totals <- tibble(day = 0:longest) %>%
mutate(
count20 = map_int(day, ~ sum(progress$diff20 <= .x, na.rm = TRUE)),
count22 = map_int(day, ~ sum(progress$diff22 <= .x, na.rm = TRUE)),
count24 = map_int(day, ~ sum(progress$diff24 <= .x, na.rm = TRUE))
)
# Null out 2024 counts beyond today
totals$count24[totals$day > curr_diff] <- NA
# ------------------------------------------------------------------------------
# Reshape for ggplot
# ------------------------------------------------------------------------------
plot_df <- totals %>%
pivot_longer(
cols = starts_with("count"),
names_to = "year",
values_to = "count"
) %>%
mutate(
year = recode(year,
count20 = "2020",
count22 = "2022",
count24 = "2024")
)
# ------------------------------------------------------------------------------
# Plot
# ------------------------------------------------------------------------------
# Using colors from https://github.mit.edu/MEDSL/MEDSL-Wiki/wiki/Branding#colors
(
ggplot(plot_df, aes(x = day, y = count, color = year)) +
geom_line(linewidth = 1.2) +
scale_color_manual(
values = c("2020" = "#989044",
"2022" = "#948DE5",
"2024" = "#D46200")
) +
scale_x_continuous(
name = "Days after election",
breaks = seq(0, max(plot_df$day), by = 50),
expand = c(0, 0)
) +
scale_y_continuous(
name = "States cleaned",
breaks = seq(0, 51, by = 5),
limits = c(0, 51),
expand = c(0, 0)
) +
geom_vline(xintercept = c(365, 730),
linetype = "dashed",
color = "grey50",
linewidth = 0.5) +
labs(
title = "Precinct Data Cleaning Progress",
caption = "MIT Election Data + Science Lab\ngithub.com/MEDSL/2024-elections-official",
color = NULL
) +
theme_medsl() +
theme(
plot.title = element_text(hjust = 0.5, size = 20),
plot.caption = element_text(hjust = 0, size = 14, lineheight = 0.8),
legend.position = "top",
legend.text = element_text(size = 12),
axis.title = element_text(size = 13),
axis.text = element_text(size = 12),
panel.grid.minor = element_blank()
)
) %>%
ggsave(
filename = file.path(WORK_DIR, "over_time.png"),
plot = .,
scale = 1,
width = 8, height = 6,
units = c("in"),
dpi = 600,
bg = "white"
)
################################################################################
# Generate a hexmap of the US, with states colored by some binary status and
# a plot of cleaning progress over time
#
# NOTE: this script assumes the branding (https://github.mit.edu/MEDSL/branding)
# and precinct project (https://github.mit.edu/MEDSL/2024-precincts) repos
# live in the same directory (PARENT_DIR) as this repo on your machine
#
# Updated by Zayne in October 2025
# based on the work of mpreece, sbaltz, and curiel
#
# To add in Puerto Rico, check https://vizpainter.com/hex-map-spatial-file/
###############################################################################
library(sf)
library(tidyverse)
library(broom)
library(this.path)
library(lubridate)
################################################################################
# Global variables
################################################################################
PARENT_DIR <- dirname(this.path::here())
WORK_DIR <- this.path::here()
STATE_CODE_PATH <- file.path(PARENT_DIR, "2024-precincts/help-files/")
# Load the MEDSL theme
source(file.path(PARENT_DIR, "branding/theme_ggplot2/medsl_theme.R"))
shapes <- read_sf(file.path(WORK_DIR, "hex_files/hex_states.shp"))
shapes = rename(shapes, state = State, state_po = State_Abbr) # Hate!
state_code_fname <- file.path(STATE_CODE_PATH, "merge_on_statecodes.csv")
################################################################################
# Read data
################################################################################
state_codes <- read.csv(state_code_fname)
progress <- read.csv(file.path(WORK_DIR, "progress.csv"))
state_codes <- merge(state_codes, progress, by = "state")
################################################################################
# Plot progress map
################################################################################
hexmap <- merge(shapes, state_codes, by=c("state_po", "state")) %>%
mutate(status=factor(status, levels = c("done", "qa", "wip", "not done")))
# Using colors from https://github.mit.edu/MEDSL/MEDSL-Wiki/wiki/Branding#colors
(
ggplot(hexmap) +
geom_sf(aes(fill = status)) +
geom_sf_text(aes(label = state_po)) +
scale_fill_manual(
values = c("done" = "#37C256",
"qa" = "#3791FF",
"wip" = "#EBD600",
"not done" = "#EDD0CB"),
labels = c("done" = "Done",
"qa" = "Quality assurance ", # Note extraneous space intentional
"wip" = "In progress",
"not done" = "Not done")
) +
theme_void() +
theme(
legend.position = "right",
legend.text = element_text(size = 8),
text=element_text(family="StyreneB-Regular"),
plot.title = element_text(size = rel(1.25), hjust = .5),
plot.caption = element_text(hjust = 0, size = 8, lineheight = 0.8),
legend.key.size = unit(0.4, "cm")
) +
labs(
title="2024 Precinct Data Progress",
# Extraneous spaces intentional to make pretty
caption = " MIT Election Data + Science Lab\n github.com/MEDSL/2024-elections-official",
fill=NULL
)
) %>%
ggsave(file.path(WORK_DIR, "progress_map.png"),
plot = .,
scale = 0.45,
width = 8, height = 6,
units = c("in"),
dpi = 600, bg="white")
################################################################################
# Plot progress over time
################################################################################
progress <- read.csv(file.path(WORK_DIR, "progress.csv"))
# Sort: states that have 2024 added dates first, NA last
progress <- progress %>%
arrange(is.na(added24), added24, added22)
# Election dates
elec_dates <- c("2020-11-03", "2022-11-08", "2024-11-05") %>% as.Date()
names(elec_dates) <- c("elec20", "elec22", "elec24")
curr_day <- Sys.Date()
curr_diff <- as.integer(round(difftime(curr_day, elec_dates["elec24"])))
progress <- progress %>%
mutate(across(starts_with("added"), lubridate::mdy))
progress <- progress %>%
mutate(
diff20 = as.integer(difftime(added20, elec_dates["elec20"])),
diff22 = as.integer(difftime(added22, elec_dates["elec22"])),
diff24 = as.integer(difftime(added24, elec_dates["elec24"]))
)
# ------------------------------------------------------------------------------
# Build cumulative totals per day
# ------------------------------------------------------------------------------
longest <- max(progress$diff20, progress$diff22, progress$diff24, na.rm = TRUE)
totals <- tibble(day = 0:longest) %>%
mutate(
count20 = map_int(day, ~ sum(progress$diff20 <= .x, na.rm = TRUE)),
count22 = map_int(day, ~ sum(progress$diff22 <= .x, na.rm = TRUE)),
count24 = map_int(day, ~ sum(progress$diff24 <= .x, na.rm = TRUE))
)
# Null out 2024 counts beyond today
totals$count24[totals$day > curr_diff] <- NA
# ------------------------------------------------------------------------------
# Reshape for ggplot
# ------------------------------------------------------------------------------
plot_df <- totals %>%
pivot_longer(
cols = starts_with("count"),
names_to = "year",
values_to = "count"
) %>%
mutate(
year = recode(year,
count20 = "2020",
count22 = "2022",
count24 = "2024")
)
# ------------------------------------------------------------------------------
# Plot
# ------------------------------------------------------------------------------
# Using colors from https://github.mit.edu/MEDSL/MEDSL-Wiki/wiki/Branding#colors
(
ggplot(plot_df, aes(x = day, y = count, color = year)) +
geom_line(linewidth = 1.2) +
scale_color_manual(
values = c("2020" = "#989044",
"2022" = "#948DE5",
"2024" = "#D46200")
) +
scale_x_continuous(
name = "Days after election",
breaks = seq(0, max(plot_df$day), by = 50),
expand = c(0, 0)
) +
scale_y_continuous(
name = "States cleaned",
breaks = seq(0, 51, by = 5),
limits = c(0, 51),
expand = c(0, 0)
) +
geom_vline(xintercept = c(365, 730),
linetype = "dashed",
color = "grey50",
linewidth = 0.5) +
labs(
title = "Precinct Data Cleaning Progress",
caption = "MIT Election Data + Science Lab\ngithub.com/MEDSL/2024-elections-official",
color = NULL
) +
theme_medsl() +
theme(
plot.title = element_text(hjust = 0.5, size = 20),
plot.caption = element_text(hjust = 0, size = 14, lineheight = 0.8),
legend.position = "top",
legend.text = element_text(size = 12),
axis.title = element_text(size = 13),
axis.text = element_text(size = 12),
panel.grid.minor = element_blank()
)
) %>%
ggsave(
filename = file.path(WORK_DIR, "over_time.png"),
plot = .,
scale = 1,
width = 8, height = 6,
units = c("in"),
dpi = 600,
bg = "white"
)
